#!/bin/sh

# Reload running server(s)

#
# Functions
#

log() {
	if [ -t 2 ]; then
		C0='\033[0m'
		C1='\033[31m'
		C2='\033[32m'
		C3='\033[33m'
		C4='\033[34m'
		C5='\033[35m'
		CB='\033[1m'
	fi
	n="${C0}"
	c="${C4}"
	p='*'
	while getopts ":eswd" opt; do
		case "${opt}" in
			e)
				p='✖'
				c="${C1}"
				;;
			s)
				p='✔'
				c="${C2}"
				;;
			w)
				p='!'
				c="${C3}"
				;;
			d)
				p='+'
				c="${C5}"
				;;
			*) ;;
		esac
	done
	shift $((OPTIND - 1))

	printf "${n}[${CB}${c}${p}${n}] ${NAME}: %s\n" "${*}" >&2
}

usage() {
	echo "${USAGE}"
}

#
# Entry
#

NAME="$(basename "${0}")"

USAGE="\
Usage: ${NAME} PID...

Reload running server(s).

Options:
  -h        Show help message and exit."

while getopts ":h" opt; do
	case "${opt}" in
		h)
			usage
			exit
			;;
		:)
			echo "${NAME}: option '-${OPTARG}' requires an argument."
			usage
			exit 1
			;;
		*)
			echo "${NAME}: unknown option '-${OPTARG}'."
			usage
			exit 1
			;;
	esac
done
shift $((OPTIND - 1))

if [ ! ${#} -gt 0 ]; then
	usage
	exit
fi

for pid in "${@}"; do
	if pgrep "${pid}" >/dev/null 2>&1; then
		log "Reloading server: ${pid}"

		kill -HUP "${pid}"
	else
		log -e "No running server with PID: ${pid}"
	fi
done
